{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "7de30674_a4a9c3a7",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 7
      },
      "lineNbr": 0,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2021-11-24T18:16:26Z",
      "side": 1,
      "message": "Verified here[1]\n\n[1]https://gerrit-ci.gerritforge.com/job/gatling-gerrit-test/591/",
      "revId": "5ebe9c0935fc1cd8500144cb717f89690f03ab05",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "02283f3a_924d025c",
        "filename": "jenkins/gatling-test-pipeline.groovy",
        "patchSetId": 7
      },
      "lineNbr": 35,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-11-24T19:18:55Z",
      "side": 1,
      "message": "Why not using LDAPS instead as a default? I believe we have it enabled and also has a valid SSL certificate.",
      "range": {
        "startLine": 35,
        "startChar": 55,
        "endLine": 35,
        "endChar": 82
      },
      "revId": "5ebe9c0935fc1cd8500144cb717f89690f03ab05",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c5254e7d_942296d2",
        "filename": "jenkins/gatling-test-pipeline.groovy",
        "patchSetId": 7
      },
      "lineNbr": 35,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2021-11-24T19:53:46Z",
      "side": 1,
      "message": "Good point, let me try",
      "parentUuid": "02283f3a_924d025c",
      "range": {
        "startLine": 35,
        "startChar": 55,
        "endLine": 35,
        "endChar": 82
      },
      "revId": "5ebe9c0935fc1cd8500144cb717f89690f03ab05",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "044c9367_f795dbc3",
        "filename": "jenkins/gatling-test-pipeline.groovy",
        "patchSetId": 7
      },
      "lineNbr": 35,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2021-11-24T20:25:09Z",
      "side": 1,
      "message": "I have tried with both:\n\nldaps://ldap.gerritforge.com [1]\n\nand\n\nldap://ldap.gerritforge.com:636 [2]\n\nTests are failing with 403\n\n@luca do you know if LDAPS is actually enabled?\n\n[1]https://gerrit-ci.gerritforge.com/job/gatling-gerrit-test/593/console\n[2]https://gerrit-ci.gerritforge.com/job/gatling-gerrit-test/594/console",
      "parentUuid": "c5254e7d_942296d2",
      "range": {
        "startLine": 35,
        "startChar": 55,
        "endLine": 35,
        "endChar": 82
      },
      "revId": "5ebe9c0935fc1cd8500144cb717f89690f03ab05",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d6818fbb_22ea9ede",
        "filename": "jenkins/gatling-test-pipeline.groovy",
        "patchSetId": 7
      },
      "lineNbr": 35,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-11-24T20:42:06Z",
      "side": 1,
      "message": "\u003e I have tried with both:\n\u003e \n\u003e ldaps://ldap.gerritforge.com [1]\n\nThis should work, but I believe the SSL certificate is self-signed.\nYou need to disable SSL validation in gerrit.config.",
      "parentUuid": "044c9367_f795dbc3",
      "range": {
        "startLine": 35,
        "startChar": 55,
        "endLine": 35,
        "endChar": 82
      },
      "revId": "5ebe9c0935fc1cd8500144cb717f89690f03ab05",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8a880eae_7a91fede",
        "filename": "jenkins/gatling-test-pipeline.groovy",
        "patchSetId": 7
      },
      "lineNbr": 35,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2021-11-25T13:07:01Z",
      "side": 1,
      "message": "Looks like that the self-signed cert is not the only thing going on.\nThe handshake fails either way.\n\nI am able to replicate with `ldapsearch` only:\n\n- PLAIN connection\n\n```\n➜  source ldapsearch -d8 -H ldap://ldap.gerritforge.com -x -D \"cn\u003dadmin,dc\u003dgerritforge,dc\u003dcom\" -b \"dc\u003dgerritforge,dc\u003dcom\" -W -s sub \u0027(\u0026(objectClass\u003dperson)(uid\u003dgerritadmin))\u0027\nEnter LDAP Password:\n# extended LDIF\n#\n# LDAPv3\n# base \u003cdc\u003dgerritforge,dc\u003dcom\u003e with scope subtree\n# filter: (\u0026(objectClass\u003dperson)(uid\u003dgerritadmin))\n# requesting: ALL\n#\n\n# gerritadmin, gerritforge.com\ndn: cn\u003dgerritadmin,dc\u003dgerritforge,dc\u003dcom\ngivenName: Gerrt\nsn: Admin\ncn: gerritadmin\n...\n```\n\n- SECURE connection (ignoring SSL validation):\n\n```\n➜  source LDAPTLS_REQCERT\u003dnever ldapsearch -d8 -H ldaps://ldap.gerritforge.com -x -D \"cn\u003dadmin,dc\u003dgerritforge,dc\u003dcom\" -b \"dc\u003dgerritforge,dc\u003dcom\" -W -s sub \u0027(\u0026(objectClass\u003dperson)(uid\u003dgerritadmin))\u0027\nEnter LDAP Password:\nTLS: during handshake: peer cert is valid, or was ignored if verification disabled (-9841)\nTLS: during handshake: Allowing untrusted peer certificate\nTLS: during handshake: connection closed via error (-9806)\nTLS: can\u0027t connect: SSLHandshake() failed: connection closed via error (-9806).\nldap_sasl_bind(SIMPLE): Can\u0027t contact LDAP server (-1)\n```\n\nNote, the `peer cert is valid` and `Allowing untrusted peer certificate`\n\n\nSomething else seems going on @luca.\nCould you check whether the server is configured correctly to handle SSL?\nOtherwise could go with plain LDAP for now?",
      "parentUuid": "d6818fbb_22ea9ede",
      "range": {
        "startLine": 35,
        "startChar": 55,
        "endLine": 35,
        "endChar": 82
      },
      "revId": "5ebe9c0935fc1cd8500144cb717f89690f03ab05",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "d64f6f3d_9cd2f9a3",
        "filename": "jenkins/gatling-test-pipeline.groovy",
        "patchSetId": 7
      },
      "lineNbr": 35,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2021-11-26T14:12:03Z",
      "side": 1,
      "message": "Thanks @luca, this now works over SSL.",
      "parentUuid": "8a880eae_7a91fede",
      "range": {
        "startLine": 35,
        "startChar": 55,
        "endLine": 35,
        "endChar": 82
      },
      "revId": "5ebe9c0935fc1cd8500144cb717f89690f03ab05",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    }
  ]
}