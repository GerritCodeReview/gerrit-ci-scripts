{
  "comments": [
    {
      "key": {
        "uuid": "30f4a3d0_6f163169",
        "filename": "gerrit-buck-build.sh",
        "patchSetId": 1
      },
      "lineNbr": 4,
      "author": {
        "id": 1011123
      },
      "writtenOn": "2014-09-17T02:57:42Z",
      "side": 1,
      "message": "why copy it?",
      "range": {
        "startLine": 4,
        "startChar": 0,
        "endLine": 4,
        "endChar": 2
      },
      "revId": "fd3ba802c139712dec5102ddd5d40ebff01e7dce",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "30bf43e0_173694f8",
        "filename": "gerrit-buck-build.sh",
        "patchSetId": 1
      },
      "lineNbr": 4,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2014-09-17T04:33:28Z",
      "side": 1,
      "message": "To have more nicer artifact name: gerrit.war?",
      "parentUuid": "30f4a3d0_6f163169",
      "range": {
        "startLine": 4,
        "startChar": 0,
        "endLine": 4,
        "endChar": 2
      },
      "revId": "fd3ba802c139712dec5102ddd5d40ebff01e7dce",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "90e54f1e_f24a0870",
        "filename": "gerrit-buck-build.sh",
        "patchSetId": 1
      },
      "lineNbr": 4,
      "author": {
        "id": 1011123
      },
      "writtenOn": "2014-09-17T05:34:55Z",
      "side": 1,
      "message": "I meant why copy it rather than renaming it?  By copying it we end up with two war files with the same content.",
      "parentUuid": "30bf43e0_173694f8",
      "range": {
        "startLine": 4,
        "startChar": 0,
        "endLine": 4,
        "endChar": 2
      },
      "revId": "fd3ba802c139712dec5102ddd5d40ebff01e7dce",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "30bf43e0_77883064",
        "filename": "gerrit-buck-build.sh",
        "patchSetId": 1
      },
      "lineNbr": 4,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2014-09-17T05:39:27Z",
      "side": 1,
      "message": "Because Buck sucks on file removal:\n\n  $ buck build gerrit\n  $ rm buck-out/gen/gerrit.war\n  $ buck build gerrit\n  $ ls buck-out/gen/gerrit.war \n  ls: cannot access buck-out/gen/gerrit.war: No such file or directory",
      "parentUuid": "90e54f1e_f24a0870",
      "range": {
        "startLine": 4,
        "startChar": 0,
        "endLine": 4,
        "endChar": 2
      },
      "revId": "fd3ba802c139712dec5102ddd5d40ebff01e7dce",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "90e54f1e_b2448063",
        "filename": "gerrit-buck-build.sh",
        "patchSetId": 1
      },
      "lineNbr": 4,
      "author": {
        "id": 1011123
      },
      "writtenOn": "2014-09-17T05:42:25Z",
      "side": 1,
      "message": "OK, but the first line of this script is `rm -Rf buck-out`.",
      "parentUuid": "30bf43e0_77883064",
      "range": {
        "startLine": 4,
        "startChar": 0,
        "endLine": 4,
        "endChar": 2
      },
      "revId": "fd3ba802c139712dec5102ddd5d40ebff01e7dce",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "30bf43e0_3792b892",
        "filename": "gerrit-buck-build.sh",
        "patchSetId": 1
      },
      "lineNbr": 4,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2014-09-17T05:55:09Z",
      "side": 1,
      "message": "... True, but note that on current master the cache is located in different directory: ~/.gerritcodereview/buck-cache/cache. See .buckconfig\n\n  [cache]\n    mode \u003d dir\n    dir \u003d ~/.gerritcodereview/buck-cache/cache\n\nSo to be 100% sure, that there is no staled cache related problem we could better wipe it out:\n\n  rm -Rf ~/.gerritcodereview/buck-cache/cache",
      "parentUuid": "90e54f1e_b2448063",
      "range": {
        "startLine": 4,
        "startChar": 0,
        "endLine": 4,
        "endChar": 2
      },
      "revId": "fd3ba802c139712dec5102ddd5d40ebff01e7dce",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ae0839ac_88d71753",
        "filename": "gerrit-buck-build.sh",
        "patchSetId": 1
      },
      "lineNbr": 4,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2015-01-09T08:03:33Z",
      "side": 1,
      "message": "Actually it would be better to wipe out completely the ~/.gerritcodereview for two reasons:\na) It is better to make a build without previous state\nb) Disk space :-)",
      "parentUuid": "30bf43e0_3792b892",
      "range": {
        "startLine": 4,
        "startChar": 0,
        "endLine": 4,
        "endChar": 2
      },
      "revId": "fd3ba802c139712dec5102ddd5d40ebff01e7dce",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "2ee36920_4c013f2e",
        "filename": "gerrit-buck-build.sh",
        "patchSetId": 1
      },
      "lineNbr": 4,
      "author": {
        "id": 1011123
      },
      "writtenOn": "2015-01-09T08:07:13Z",
      "side": 1,
      "message": "\u003e wipe out completely the ~/.gerritcodereview\n\nIs it possible for builds to run concurrently?  If so would be better to specify the cache directory per build rather than using the Jenkins user\u0027s home.\n\nAlso we probably don\u0027t want to wipe out the whole folder, only the buck build cache.  Wiping it out completely will mean it has to re-download the dependency jar files every time.",
      "parentUuid": "ae0839ac_88d71753",
      "range": {
        "startLine": 4,
        "startChar": 0,
        "endLine": 4,
        "endChar": 2
      },
      "revId": "fd3ba802c139712dec5102ddd5d40ebff01e7dce",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ae0839ac_48da3f7c",
        "filename": "gerrit-buck-build.sh",
        "patchSetId": 1
      },
      "lineNbr": 4,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2015-01-09T08:13:34Z",
      "side": 1,
      "message": "In theory yes, in practice not really: the build itself takes a lot of resources and the only possibility to build concurrently would be using different slaves which would use anyway separate ~/.gerritcodereview directories.\n\nWith regards to dependency downloads, it is a good practice to not rely on them as many things may happen:\n- Download source URL becomes unavailable (if we depend by mistake from a temporary build)\n- Download redirected to unsafe SSL connection\n\nBy downloading again everything, we take more time and more bandwidth *BUT* we actually simulate the experience of a new Gerrit users that tries to clone and build from the first time: if we brake something of *that* experience we will notice from the CI build.\n\nPossibly maybe wiping out cache before the build and *everything* once a week?",
      "parentUuid": "2ee36920_4c013f2e",
      "range": {
        "startLine": 4,
        "startChar": 0,
        "endLine": 4,
        "endChar": 2
      },
      "revId": "fd3ba802c139712dec5102ddd5d40ebff01e7dce",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ee0eb1b4_2ae7ff3f",
        "filename": "gerrit-buck-build.sh",
        "patchSetId": 1
      },
      "lineNbr": 4,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2015-01-09T08:22:39Z",
      "side": 1,
      "message": "| Possibly maybe wiping out cache before the build and *everything* once a week?\n\nCan\u0027t we just make assumption that Buck and its cache mechanism works as expected? You also don\u0027t reinstall your operation system, JDK, ... weekly, don\u0027t you?",
      "parentUuid": "ae0839ac_48da3f7c",
      "range": {
        "startLine": 4,
        "startChar": 0,
        "endLine": 4,
        "endChar": 2
      },
      "revId": "fd3ba802c139712dec5102ddd5d40ebff01e7dce",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ee0eb1b4_eaefa713",
        "filename": "gerrit-buck-build.sh",
        "patchSetId": 1
      },
      "lineNbr": 4,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2015-01-09T08:25:27Z",
      "side": 1,
      "message": "Yes, we can ... but better safe than sorry ;-)\n\nWiping out the slave machine altogether and re-instantiating it through Puppet is actually a good idea indeed ;-) That would allow me to spawn different slaves as needed: additionally should new JDK fixes come around and our code breaking (for any reason !) we would notice that as well.\n\nP.S. I mean once a week, NOT every day for for every build.",
      "parentUuid": "ee0eb1b4_2ae7ff3f",
      "range": {
        "startLine": 4,
        "startChar": 0,
        "endLine": 4,
        "endChar": 2
      },
      "revId": "fd3ba802c139712dec5102ddd5d40ebff01e7dce",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "4ed6dd40_cd1f6985",
        "filename": "gerrit-buck-build.sh",
        "patchSetId": 1
      },
      "lineNbr": 4,
      "author": {
        "id": 1011123
      },
      "writtenOn": "2015-01-09T08:26:38Z",
      "side": 1,
      "message": "The problem is that if buck\u0027s cache mechanism works as expected, we won\u0027t see when an artifact disappears from the source repository or its hash changes.\n\nIs that really a likely situation though?  I don\u0027t remember seeing the former case, and the latter has only happened when we used the google bucket rather than a real maven repo.",
      "parentUuid": "ee0eb1b4_2ae7ff3f",
      "range": {
        "startLine": 4,
        "startChar": 0,
        "endLine": 4,
        "endChar": 2
      },
      "revId": "fd3ba802c139712dec5102ddd5d40ebff01e7dce",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ee0eb1b4_caf4e3e6",
        "filename": "gerrit-buck-build.sh",
        "patchSetId": 1
      },
      "lineNbr": 4,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2015-01-09T08:33:16Z",
      "side": 1,
      "message": "It is not a situation that is *likely* to happen: but *if* it happens we would like to detect it.\n\nOnce a week is not a big cost and will not be in this script anyway, but rather in my crontab :-) ... so we can take it off-line and avoid to wipe out cache (that was the topic of discussion on this thread).",
      "parentUuid": "4ed6dd40_cd1f6985",
      "range": {
        "startLine": 4,
        "startChar": 0,
        "endLine": 4,
        "endChar": 2
      },
      "revId": "fd3ba802c139712dec5102ddd5d40ebff01e7dce",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ae0839ac_a8e9bb10",
        "filename": "gerrit-buck-build.sh",
        "patchSetId": 1
      },
      "lineNbr": 4,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2015-01-09T08:43:49Z",
      "side": 1,
      "message": "| Is that really a likely situation though?\n\nNo.\n\n| the latter has only happened when we used the google bucket rather than a real maven repo.\n\nYes. I already commented in another change that Google bucket urgently needs to support publish/freeze an binary artifact, like it\u0027s the case on Maven Central.\n\nUntil this happens, we should try to avoid using it and either:\n\n* Don\u0027t create our custom binary packages at all, and use native libraries provided: CodeMirror is available twice: on GitHub and on Maven Central\n* Move libraries Gerrit depends on from bucket to Maven Central: There are only two left: gwtjsonrpc and gwtorm",
      "parentUuid": "4ed6dd40_cd1f6985",
      "range": {
        "startLine": 4,
        "startChar": 0,
        "endLine": 4,
        "endChar": 2
      },
      "revId": "fd3ba802c139712dec5102ddd5d40ebff01e7dce",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ee0eb1b4_6a04d73f",
        "filename": "gerrit-buck-build.sh",
        "patchSetId": 1
      },
      "lineNbr": 4,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2015-01-09T08:43:49Z",
      "side": 1,
      "message": "Nope, it cannot happen, if you use the right tool for the job, see my comment above.\n\nYour CI Server can be hit by a cosmos meteorite, right? What are you gong to do against that?",
      "parentUuid": "ee0eb1b4_caf4e3e6",
      "range": {
        "startLine": 4,
        "startChar": 0,
        "endLine": 4,
        "endChar": 2
      },
      "revId": "fd3ba802c139712dec5102ddd5d40ebff01e7dce",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ae0839ac_a8241bd6",
        "filename": "gerrit-buck-build.sh",
        "patchSetId": 1
      },
      "lineNbr": 4,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2015-01-09T09:06:29Z",
      "side": 1,
      "message": "Armageddon right? At least we know now how to land on a comet ... possibly next step to land on a meteorite and deviate it before it would hit our CI ;-)\n\nAny \"meteorite-style\" clean-up would not land on the Job YAML definition anyway :-)",
      "parentUuid": "ee0eb1b4_6a04d73f",
      "range": {
        "startLine": 4,
        "startChar": 0,
        "endLine": 4,
        "endChar": 2
      },
      "revId": "fd3ba802c139712dec5102ddd5d40ebff01e7dce",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ee0eb1b4_aa240fd6",
        "filename": "gerrit-buck-build.sh",
        "patchSetId": 1
      },
      "lineNbr": 4,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2015-01-09T09:10:11Z",
      "side": 1,
      "message": "But we could add a TODO section for that already?\n\n;-)",
      "parentUuid": "ae0839ac_a8241bd6",
      "range": {
        "startLine": 4,
        "startChar": 0,
        "endLine": 4,
        "endChar": 2
      },
      "revId": "fd3ba802c139712dec5102ddd5d40ebff01e7dce",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "4edc1d30_bdea7fae",
        "filename": "gerrit-buck-template.yaml",
        "patchSetId": 1
      },
      "lineNbr": 6,
      "author": {
        "id": 1011123
      },
      "writtenOn": "2015-01-09T03:05:28Z",
      "side": 1,
      "message": "-1 is the default, so doesn\u0027t need to be specified.",
      "range": {
        "startLine": 6,
        "startChar": 6,
        "endLine": 6,
        "endChar": 20
      },
      "revId": "fd3ba802c139712dec5102ddd5d40ebff01e7dce",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "6edf2124_7e2711a2",
        "filename": "gerrit-buck-template.yaml",
        "patchSetId": 1
      },
      "lineNbr": 8,
      "author": {
        "id": 1011123
      },
      "writtenOn": "2015-01-09T03:05:28Z",
      "side": 1,
      "message": "-1 is the default, so doesn\u0027t need to be specified.",
      "range": {
        "startLine": 8,
        "startChar": 6,
        "endLine": 8,
        "endChar": 28
      },
      "revId": "fd3ba802c139712dec5102ddd5d40ebff01e7dce",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "6edf2124_5e225593",
        "filename": "gerrit-buck-template.yaml",
        "patchSetId": 1
      },
      "lineNbr": 39,
      "author": {
        "id": 1011123
      },
      "writtenOn": "2015-01-09T03:05:28Z",
      "side": 1,
      "message": "There is no more development on stable-2.8, so that can be removed.\n\nAfter creating stable-2.11 I don\u0027t think we\u0027ll want to maintain stable-2.9 any more. I don\u0027t intend to make any more 2.9.x releases unless something critical comes up.",
      "range": {
        "startLine": 38,
        "startChar": 0,
        "endLine": 39,
        "endChar": 18
      },
      "revId": "fd3ba802c139712dec5102ddd5d40ebff01e7dce",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    }
  ]
}