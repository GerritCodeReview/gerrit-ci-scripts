- job:
    name: Gerrit-verifier-bazel
    description: "Gerrit build of open change with Bazel\n"
    defaults: verifier-defaults
    node: bazel-debian
    builders:
      - shell: !include-raw-escape: gerrit-bazel-merge-target-branch.sh
      - shell: !include-raw-escape: gerrit-bazel-fetch-all-submodules.sh
      - shell: !include-raw-escape: gerrit-bazel-build.sh
      - shell: !include-raw-escape: gerrit-bazel-verifier-test.sh
      - shell: !include-raw-escape: gerrit-bazel-cat-test-log.sh
    publishers:
      - archive:
          artifacts: >
            gerrit/bazel-bin/*.war,gerrit/bazel-bin/plugins/*/*.jar,
            gerrit/bazel-bin/*api/*api.jar,
            gerrit/bazel-bin/gerrit-acceptance-framework/*.jar
          excludes: 'gerrit/bazel-bin/plugins/core*/**/*.jar'

- job:
    name: 'Gerrit-verifier-change'
    project-type: flow
    concurrent: true
    needs-workspace: true
    node: master
    parameters:
      - string:
          name: CHANGE_ID
          description: Gerrit Change-ID to build and verify
    scm:
      - git:
          url: https://gerrit.googlesource.com/gerrit
          branches:
            - '*/master'
          submodule:
            disable: true
          skip-tag: true
    dsl: !include-raw: gerrit-verifier-change.groovy
    properties:
      - build-discarder:
          days-to-keep: 7
      - inject:
          keep-build-variables: true
          keep-system-variables: true

- job:
    name: 'Gerrit-verifier-flow'
    concurrent: true
    project-type: flow
    triggers:
      - timed: 'H/5 * * * *'
    dsl: !include-raw: gerrit-verifier-flow.groovy
    properties:
      - build-discarder:
          days-to-keep: 1
