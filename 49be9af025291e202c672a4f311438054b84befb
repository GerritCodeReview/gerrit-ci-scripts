{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "cefcdbfc_6253a8bc",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2021-02-19T16:32:17Z",
      "side": 1,
      "message": "See my change in gerrit and the comments on that option in change 297355.\n",
      "revId": "49be9af025291e202c672a4f311438054b84befb",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "1f95aac7_e595b308",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-02-20T02:22:40Z",
      "side": 1,
      "message": "It looks like this would be needed for all builds, RBE, non-RBE, all branches, also plugins.",
      "parentUuid": "cefcdbfc_6253a8bc",
      "revId": "49be9af025291e202c672a4f311438054b84befb",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "8b1978cd_ae3a163d",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-02-20T02:22:40Z",
      "side": 1,
      "message": "Need to add the option to all other builds as well.",
      "revId": "49be9af025291e202c672a4f311438054b84befb",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "8891c283_c28ed907",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1024147
      },
      "writtenOn": "2021-02-22T10:09:59Z",
      "side": 1,
      "message": "curious. What is the value of $HOME for these invocations?",
      "revId": "49be9af025291e202c672a4f311438054b84befb",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "28456a5e_0c8412f6",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2021-02-22T10:24:12Z",
      "side": 1,
      "message": "\u003e What is the value of $HOME for these invocations?\n\nAsk Bazel team why they do it and got 100% cache hits, for all projects, Bazel,  Gerrit, etc, e.g.: [1]?\n\n  bazel build --show_progress_rate_limit\u003d5 --curses\u003dyes \\\n  --color\u003dyes --terminal_columns\u003d143 --show_timestamps \\\n  --verbose_failures --jobs\u003d75 --announce_rc \\\n  --experimental_repository_cache_hardlinks --disk_cache\u003d \\\n  --sandbox_tmpfs_path\u003d/tmp --config\u003dubuntu1604_java8 \\\n  --remote_executor\u003dgrpcs://remotebuildexecution.googleapis.com \\\n  --jobs\u003d200 --experimental_remote_download_outputs\u003dminimal \\\n  --experimental_inmemory_jdeps_files --experimental_inmemory_dotd_files \\\n  --experimental_generate_json_trace_profile --experimental_profile_cpu_usage \\\n  --experimental_json_trace_compression \\\n  --profile\u003d/tmp/tmpqsoh7dzz/build.profile.gz \\\n  --test_env\u003dHOME \\\n  -- //src:bazel //src:bazel_jdk_minimal\n\n[1] https://buildkite.com/bazel/bazel-bazel/builds/15487#0121ac34-8629-4cda-950f-bedfed5e87aa",
      "parentUuid": "8891c283_c28ed907",
      "revId": "49be9af025291e202c672a4f311438054b84befb",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "d5e4c7d6_b352062a",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2021-02-22T10:36:57Z",
      "side": 1,
      "message": "Of course, instead of just guessing and sporadic copy/paste of some options from Bazel Buildkite enveironment, we should do a systematic approach to debug remote cache misses on RBE, as described in: [1].\n\nUse Case:\n\n1. Login per SSH to GCP instance, e.g.: gerrit-ci-workers-61\n2. Clone gerrit recursively\n3. Checkout commit foo\n4. Run all tests on RBE\n5. Disconnnect\n6. Login per SSH to GCP instance, e.g.: gerrit-ci-workers-62\n7. Clone gerrit recursively\n8. Checkout commit foo\n9. Run all tests on RBE\n\nExpected: 100% remote cache hits. Compare the execution logs to troubleshoot remote cache misses.\n\n[1] https://docs.bazel.build/versions/master/remote-execution-caching-debug.html",
      "parentUuid": "28456a5e_0c8412f6",
      "revId": "49be9af025291e202c672a4f311438054b84befb",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "9146a991_9459480b",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1024147
      },
      "writtenOn": "2021-02-22T10:39:03Z",
      "side": 1,
      "message": "you\u0027re not answering the question, though. what happens if you add\n\n  echo $HOME \n\nto the script? What does it print?",
      "parentUuid": "d5e4c7d6_b352062a",
      "revId": "49be9af025291e202c672a4f311438054b84befb",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "3750d8d7_f6b04e57",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-02-22T15:47:46Z",
      "side": 1,
      "message": "It is already in the Jenkins properties of the worker run ([1]):\nHOME\u003d/home/jenkins\n\nAll executions have exactly the same environment, apart from the HOSTNAME and DOCKER_HOST variables.\n\n[1] https://gerrit-ci.gerritforge.com/computer/gcloud63-5cb141e26f4c/systemInfo",
      "parentUuid": "9146a991_9459480b",
      "revId": "49be9af025291e202c672a4f311438054b84befb",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "b6918b57_94b2903e",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2021-02-22T16:20:46Z",
      "side": 1,
      "message": "I tried to reproduce the problem on GCP and was not able to reproduce it, even without --test_env\u003dHOME.\n\nI was building Gerrit@HEAD on gerrit-ci-workers-61 (HOME\u003d/home/jenkins)\n\n  $ $ bazelisk test --execution_log_binary_file\u003d/tmp/exec1.log --config\u003dremote \\\n  --remote_instance_name\u003d\u003cPROJECT_NAME\u003e --test_output errors \\\n  --flaky_test_attempts 3 --build_tests_only --test_timeout 3600 \\\n  javatests/com/google/gerrit/acceptance/server/change:server_change\n\nINFO: Elapsed time: 432.440s, Critical Path: 394.98s\nINFO: 899 processes: 737 remote cache hit, 142 internal, 20 remote.\nINFO: Build completed successfully, 899 total actions\n//javatests/com/google/gerrit/acceptance/server/change:server_change     PASSED in 332.2s\n\nINFO: Build completed successfully, 899 total actions\n\n\nAfter that I was running the same command on gerrit-ci-workers-62. For the reference I am doing the following:\n\n  [david_ostrovsky@gerrit-ci-workers-62 ~]$ pwd\n  /home/david_ostrovsky\n\n  sudo docker run --privileged -it --entrypoint\u003dbash gerritforge/jenkins-slave-bazel-docker:debian-buster-69.0.3497.92\n\n  root@cfce504d7e30:/# su - jenkins\n\n  jenkins@cfce504d7e30:~$ git clone --recursive https://gerrit-review.googlesource.com/gerrit\n\n  enkins@cfce504d7e30:~$ cd gerrit/\njenkins@cfce504d7e30:~/gerrit$ echo $HOME\n  /home/jenkins\n\n  jenkins@cfce504d7e30:~/gerrit$ git show\n  commit d22d4a8b489debf3f28a5ede993e4a5716d0398d (HEAD -\u003e master, origin/master, origin/HEAD)\n\n  $ bazelisk test --report_ca \\\n  --execution_log_binary_file\u003d/tmp/exec2.log --config\u003dremote \\\n  --remote_instance_name\u003d\u003cPROJECT_NAME\u003e --test_output errors \\\n  --flaky_test_attempts 3 --build_tests_only --test_timeout 3600 \\\n  javatests/com/google/gerrit/acceptance/server/change:server_change\n\narget //javatests/com/google/gerrit/acceptance/server/change:server_change up-to-date:\n  bazel-bin/javatests/com/google/gerrit/acceptance/server/change/server_change.jar\n  bazel-bin/javatests/com/google/gerrit/acceptance/server/change/server_change\nINFO: Elapsed time: 49.509s, Critical Path: 14.84s\nINFO: 899 processes: 756 remote cache hit, 142 internal, 1 remote.\nINFO: Build completed successfully, 899 total actions\n//javatests/com/google/gerrit/acceptance/server/change:server_change (cached) PASSED in 0.3s\n\nExecuted 0 out of 1 test: 1 test passes.\n\nAs can be seen, it just works, even without any addition --test_env\u003dHOME, we should investigate cache misses further to actually understand what is going on.",
      "parentUuid": "3750d8d7_f6b04e57",
      "revId": "49be9af025291e202c672a4f311438054b84befb",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    }
  ]
}