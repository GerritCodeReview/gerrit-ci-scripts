{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "613162af_b83329b8",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2021-05-13T08:55:40Z",
      "side": 1,
      "message": "test",
      "revId": "e2e2e4aae6b655c9e6da769f1898886f3d819f47",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "17937a48_6d123f10",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-05-14T00:59:56Z",
      "side": 1,
      "message": "I am fine to accept dropping old Chrome versions and WCT altogether.\nHowever, that would have the consequence of dropping the validation of Gerrit v2.16 and declaring a de-facto EOL of that release (with the exception of the NoteDb migration process, which does not actually require to even run Gerrit).\n\nWe do need the ESC to discuss with the Community and make a decision about it.\nUntil then, I believe this change cannot proceed as-is.",
      "revId": "e2e2e4aae6b655c9e6da769f1898886f3d819f47",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "f025168c_5fc57204",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2021-05-14T01:24:24Z",
      "side": 1,
      "message": "Set CRVW-2 based on Luca\u0027s comments. ",
      "revId": "e2e2e4aae6b655c9e6da769f1898886f3d819f47",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7109a027_bd334908",
        "filename": "jenkins-docker/chrome-vers.mk",
        "patchSetId": 3
      },
      "lineNbr": 1,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-05-14T00:59:56Z",
      "side": 1,
      "message": "We should also keep 69.0.3497.92 for now, until we decide to drop support and validation for v2.16 (with the exception of NoteDb conversion of course)",
      "revId": "e2e2e4aae6b655c9e6da769f1898886f3d819f47",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "acbd6518_e6405e27",
        "filename": "jenkins-docker/slave-chrome/Dockerfile",
        "patchSetId": 3
      },
      "lineNbr": 7,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2021-05-13T08:55:40Z",
      "side": 1,
      "message": "This is the latest release: 90.0.4430.212-1\n\n  Selecting previously unselected package google-chrome-stable.\n(Reading database ... 39251 files and directories currently installed.)\nPreparing to unpack /tmp/chrome.deb ...\nUnpacking google-chrome-stable (90.0.4430.212-1) ...\ndpkg: dependency problems prevent configuration of google-chrome-stable:\n google-chrome-stable depends on fonts-liberation; however:\n  Package fonts-liberation is not installed.",
      "revId": "e2e2e4aae6b655c9e6da769f1898886f3d819f47",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7b72d834_11b6be9b",
        "filename": "jenkins-docker/slave-chrome/Dockerfile",
        "patchSetId": 3
      },
      "lineNbr": 7,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-05-14T00:59:56Z",
      "side": 1,
      "message": "AFAIK Google doesn\u0027t provide the old versions of Chrome for download.\n\nAlso, the release is not going to be 90.0.4430.212-1 for longer: it will create the nasty situation where a rebuild of the same image twice would produce two different results that may also break existing tests.\n\nI know that Google always updates Gerrit master with the latest Chrome version and keep the tests green, however, that does not necessarily happens for stable branches.",
      "range": {
        "startLine": 7,
        "startChar": 36,
        "endLine": 7,
        "endChar": 49
      },
      "revId": "e2e2e4aae6b655c9e6da769f1898886f3d819f47",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a0aa17bf_f9a6d815",
        "filename": "jenkins-docker/slave-chrome/Dockerfile",
        "patchSetId": 3
      },
      "lineNbr": 7,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2021-05-14T02:59:53Z",
      "side": 1,
      "message": "Besides all the above arguments, Karma tests just don\u0027t work against latest Chrome version, at least not in docker. (It works for me locally)\n\nSteps to reproduce the problem in docker with the latest Chrome distribution:\n\n1. apply this change\n2. build slave-debian image\n3. build slave-chrome image\n4. build slave-bazel-nocache\n5. run resulting docker image\n\n  $ docker run  -it gerritforge/gerrit-ci-slave-bazel:debian-buster-nocache-90.0.4430 bash\n\n6. change to jenkins user:\n\n  $ su - jenkins\n\n7. clone gerrit:\n\n  $ git clone https://gerrit-review.googlesource.com/gerrit\n\n8. change to gerrit directory\n\n  $ cd gerrit\n\n9. Run karma tests on Gerrit@HEAD:\n\n  jenkins@6b20363584dd:~/projects/gerrit$ ./polygerrit-ui/app/run_test.sh\n  [...]\n\nThe tests is failing with:\n\n4 05 2021 02:38:29.404:ERROR [launcher]: ChromeHeadless stderr: mkdir: cannot create directory \u0027/.local\u0027: Permission denied\ntouch: cannot touch \u0027/.local/share/applications/mimeapps.list\u0027: No such file or directory\nFailed to move to new namespace: PID namespaces supported, Network namespace supported, but failed: errno \u003d Operation not permitted\nFailed to generate minidump.\n14 05 2021 02:38:29.405:ERROR [launcher]: ChromeHeadless failed 2 times (cannot start). Giving up.\n\nComplete error log is here: [1].\n\n[1] http://paste.openstack.org/show/805372",
      "parentUuid": "7b72d834_11b6be9b",
      "range": {
        "startLine": 7,
        "startChar": 36,
        "endLine": 7,
        "endChar": 49
      },
      "revId": "e2e2e4aae6b655c9e6da769f1898886f3d819f47",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "fcb8e190_21229336",
        "filename": "jenkins-docker/slave-chrome/Dockerfile",
        "patchSetId": 3
      },
      "lineNbr": 7,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2021-05-14T03:56:21Z",
      "side": 1,
      "message": "Running HeadlessChrome without sandbox solved it, this diff:\n\ndiff --git a/polygerrit-ui/karma.conf.js b/polygerrit-ui/karma.conf.js\nindex fe3fa0ceea..bb68732fd7 100644\n--- a/polygerrit-ui/karma.conf.js\n+++ b/polygerrit-ui/karma.conf.js\n@@ -209,7 +209,7 @@ module.exports \u003d function(config) {\n       // Based on https://developers.google.com/web/updates/2017/06/headless-karma-mocha-chai\n       \"CustomChromeHeadless\": {\n         base: \u0027ChromeHeadless\u0027,\n-        flags: [\u0027--disable-translate\u0027, \u0027--disable-extensions\u0027],\n+        flags: [\u0027--disable-translate\u0027, \u0027--disable-extensions\u0027, \u0027--no-sandbox\u0027],\n       },\n       \"ChromeDev\": {\n         base: \u0027Chrome\u0027,\n\nthe log is:\n\n  START:\n14 05 2021 03:50:44.749:INFO [karma-server]: Karma v4.4.1 server started at http://0.0.0.0:9876/\n14 05 2021 03:50:44.751:INFO [launcher]: Launching browsers CustomChromeHeadless with concurrency unlimited\n14 05 2021 03:50:44.757:INFO [launcher]: Starting browser ChromeHeadless\n14 05 2021 03:50:47.722:INFO [HeadlessChrome 86.0.4240 (Linux 0.0.0)]: Connected on socket rpBeg828d7w0SAX0AAAA with id 35603074\n  [...]\n  //polygerrit-ui:karma_test                                               PASSED in 117.1s",
      "parentUuid": "a0aa17bf_f9a6d815",
      "range": {
        "startLine": 7,
        "startChar": 36,
        "endLine": 7,
        "endChar": 49
      },
      "revId": "e2e2e4aae6b655c9e6da769f1898886f3d819f47",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b131a2b5_b0f9fa7e",
        "filename": "jenkins-docker/slave-node-wct/Dockerfile",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-05-14T00:59:56Z",
      "side": 1,
      "message": "We need an ESC decision to drop v2.16 (with exclusion of just the NoteDb migration) before accepting this removal.",
      "revId": "e2e2e4aae6b655c9e6da769f1898886f3d819f47",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e8430790_756dc931",
        "filename": "jenkins-docker/slave-release/Dockerfile",
        "patchSetId": 3
      },
      "lineNbr": 1,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-05-14T00:59:56Z",
      "side": 1,
      "message": "This version is misleading: the Dockerfile actually just gets the \"latest and greatest\". Should this be called just \u0027latest\u0027 ?",
      "range": {
        "startLine": 1,
        "startChar": 61,
        "endLine": 1,
        "endChar": 70
      },
      "revId": "e2e2e4aae6b655c9e6da769f1898886f3d819f47",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b8433783_a5c61179",
        "filename": "jenkins-docker/slave-release/Makefile",
        "patchSetId": 3
      },
      "lineNbr": 42,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-05-14T00:59:56Z",
      "side": 1,
      "message": "latest",
      "range": {
        "startLine": 42,
        "startChar": 69,
        "endLine": 42,
        "endChar": 78
      },
      "revId": "e2e2e4aae6b655c9e6da769f1898886f3d819f47",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "897e4be5_1c9d3727",
        "filename": "jenkins-docker/slave-sbt/Dockerfile",
        "patchSetId": 3
      },
      "lineNbr": 1,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-05-14T00:59:56Z",
      "side": 1,
      "message": "latest",
      "range": {
        "startLine": 1,
        "startChar": 53,
        "endLine": 1,
        "endChar": 62
      },
      "revId": "e2e2e4aae6b655c9e6da769f1898886f3d819f47",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    }
  ]
}